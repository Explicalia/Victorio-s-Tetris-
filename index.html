<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0a14">
<meta name="description" content="Tetris por Explicalia ‚Äî El juego de bloques definitivo.">
<meta name="mobile-web-app-capable" content="yes">
<meta name="format-detection" content="telephone=no">
<meta property="og:title" content="Tetris ¬∑ Explicalia">
<meta property="og:description" content="¬øCu√°ntas l√≠neas aguantas sin perder?">
<meta property="og:type" content="website">
<link rel="manifest" href="application/json,{}">
<title>Tetris ¬∑ Explicalia</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
TETRIS ¬∑ EXPLICALIA ‚Äî v6.1 Apple Style Edition
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root {
--f-display: 'DM Sans', -apple-system, 'SF Pro Display', BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
--f-body: 'Space Grotesk', -apple-system, 'SF Pro Text', BlinkMacSystemFont, sans-serif;
--bg: #0a0a14;
--bg-gradient: linear-gradient(180deg, #0d0d1a 0%, #0a0a14 50%, #080810 100%);
--surface: rgba(28, 28, 48, 0.85);
--surface-light: rgba(28, 28, 48, 0.6);
--glass-border: rgba(255, 255, 255, 0.06);
--glass-border-hover: rgba(255, 255, 255, 0.1);
--glass-shine: rgba(255, 255, 255, 0.04);
--blur: saturate(180%) blur(24px);
--sat: env(safe-area-inset-top, 0px);
--sab: env(safe-area-inset-bottom, 0px);
--sal: env(safe-area-inset-left, 0px);
--sar: env(safe-area-inset-right, 0px);
--spring: cubic-bezier(.34, 1.56, .64, 1);
--ease-out: cubic-bezier(.22, 1, .36, 1);
--blue: #007AFF;
--indigo: #5856D6;
--purple: #BF5AF2;
--pink: #FF375F;
--red: #FF453A;
--orange: #FF9F0A;
--yellow: #FFD60A;
--green: #30D158;
--teal: #64D2FF;
--cyan: #0A84FF;
--cI: #00E5FF;
--cO: #FFEA00;
--cT: #D500F9;
--cS: #00E676;
--cZ: #FF1744;
--cJ: #2979FF;
--cL: #FF9100;
--sp-xs: clamp(2px, 0.5vmin, 4px);
--sp-sm: clamp(4px, 1vmin, 8px);
--sp-md: clamp(8px, 2vmin, 16px);
--sp-lg: clamp(12px, 3vmin, 24px);
--sp-xl: clamp(16px, 4vmin, 32px);
}
*, *::before, *::after {
box-sizing: border-box;
margin: 0;
padding: 0;
-webkit-tap-highlight-color: transparent;
-webkit-touch-callout: none;
}
html, body {
width: 100%;
height: 100%;
background: var(--bg);
color: #fff;
overflow: hidden;
font-family: var(--f-body);
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
text-rendering: optimizeLegibility;
}
body {
touch-action: none;
position: fixed;
inset: 0;
}
@media (prefers-reduced-motion: reduce) {
*, *::before, *::after {
animation-duration: 0.01ms !important;
animation-iteration-count: 1 !important;
transition-duration: 0.01ms !important;
}
}
#amb {
position: fixed;
inset: 0;
z-index: 0;
pointer-events: none;
overflow: hidden;
will-change: transform;
background: var(--bg-gradient);
}
.orb {
position: absolute;
border-radius: 50%;
filter: blur(80px);
animation: drift linear infinite;
will-change: transform;
}
@keyframes drift {
0% { transform: translate(0, 0) scale(1); }
33% { transform: translate(28px, -36px) scale(1.09); }
66% { transform: translate(-18px, 28px) scale(.93); }
100% { transform: translate(0, 0) scale(1); }
}
#lf {
position: fixed;
inset: 0;
z-index: 900;
pointer-events: none;
opacity: 0;
background: radial-gradient(ellipse at 50% 40%, rgba(0, 122, 255, .18), transparent 70%);
transition: opacity .06s;
}
#lf.on { opacity: 1; }
#app {
position: fixed;
inset: 0;
z-index: 1;
}
.scr {
position: absolute;
inset: 0;
display: none;
flex-direction: column;
overflow: hidden;
animation: scrIn .32s var(--ease-out) both;
}
.scr.on { display: flex; }
@keyframes scrIn {
from { opacity: 0; transform: translateY(8px); }
to { opacity: 1; transform: translateY(0); }
}
.sw {
overflow-y: auto;
overflow-x: hidden;
-webkit-overflow-scrolling: touch;
overscroll-behavior-y: contain;
flex: 1;
min-height: 0;
scrollbar-width: thin;
scrollbar-color: rgba(255,255,255,.1) transparent;
}
.sw::-webkit-scrollbar { width: 3px; }
.sw::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 2px; }
.btn {
display: block;
width: 100%;
padding: clamp(14px, 3.5vmin, 18px) 20px;
border: none;
border-radius: 14px;
cursor: pointer;
font-size: clamp(.88rem, 2.4vmin, 1.05rem);
font-weight: 700;
font-family: var(--f-body);
color: #fff;
background: linear-gradient(135deg, var(--blue) 0%, var(--indigo) 100%);
box-shadow: 0 2px 0 rgba(255,255,255,0.15) inset, 0 8px 24px rgba(0,122,255,0.4);
position: relative;
overflow: hidden;
letter-spacing: .3px;
transition: transform .12s var(--spring), box-shadow .12s;
will-change: transform;
}
.btn::before {
content: '';
position: absolute;
inset: 0;
background: linear-gradient(to bottom, rgba(255,255,255,.16), transparent);
pointer-events: none;
}
.btn:active {
transform: scale(.97);
box-shadow: 0 2px 8px rgba(0,122,255,.22);
}
.btn.ghost {
background: rgba(28, 28, 48, 0.6);
border: 1px solid var(--glass-border);
box-shadow: none;
color: rgba(255,255,255,.68);
font-weight: 600;
}
.btn.ghost:active { background: rgba(255,255,255,.1); }
.btn.red {
background: linear-gradient(135deg, var(--pink), var(--purple));
box-shadow: 0 5px 18px rgba(255,45,85,.3);
}
.btn.green {
background: linear-gradient(135deg, var(--green), var(--teal));
box-shadow: 0 5px 18px rgba(52,199,89,.28);
}
.slbl {
font-size: clamp(.55rem, 1.4vmin, .65rem);
font-weight: 700;
letter-spacing: 1.8px;
text-transform: uppercase;
color: rgba(255,255,255,.27);
margin-bottom: 9px;
font-family: var(--f-body);
}
@media (hover: hover) {
.btn:hover { transform: translateY(-1px); box-shadow: 0 1px 0 rgba(255,255,255,.22) inset, 0 8px 28px rgba(0,122,255,.44); }
.btn.ghost:hover { background: rgba(255,255,255,.08); border-color: rgba(255,255,255,.18); }
.btn.red:hover { box-shadow: 0 8px 28px rgba(255,45,85,.4); }
.btn.green:hover { box-shadow: 0 8px 28px rgba(52,199,89,.38); }
.mc:hover { background: rgba(255,255,255,.07); border-color: rgba(255,255,255,.14); }
}
.rank-badge { display: inline-flex; align-items: center; gap: 6px; background: rgba(28, 28, 48, 0.5); border: 1px solid rgba(255,255,255,0.06); border-radius: 20px; padding: 4px 12px 4px 8px; font-size: .65rem; font-weight: 700; color: rgba(255,255,255,.5); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 1px; }
.rank-badge .rank-ico { font-size: .85rem; }
#l-streak { display: none; background: rgba(255,149,0,0.08); border: 1px solid rgba(255,149,0,0.15); border-radius: 10px; padding: 6px 14px; font-size: .72rem; font-weight: 700; color: var(--orange); text-align: center; margin-bottom: 12px; width: 100%; }
#l-challenge { font-size: clamp(.72rem, 1.9vmin, .84rem); color: var(--cyan); font-weight: 600; margin-top: 10px; text-align: center; min-height: 1.2em; opacity: 0; animation: fUp .5s var(--ease-out) .3s both; }
#s1 { background: var(--bg-gradient); }
#rain { position: absolute; inset: 0; z-index: 0; pointer-events: none; }
.l-wrap {
position: relative;
z-index: 1;
max-width: 500px;
margin: 0 auto;
padding: calc(var(--sat) + clamp(16px, 4vmin, 28px)) 20px calc(var(--sab) + 30px);
display: flex;
flex-direction: column;
align-items: center;
}
.brand {
display: flex;
flex-direction: column;
align-items: center;
text-align: center;
margin-bottom: clamp(16px, 4vmin, 28px);
}
.logo-box {
width: clamp(60px, 16vmin, 80px);
height: clamp(60px, 16vmin, 80px);
border-radius: 22px;
background: linear-gradient(145deg, rgba(28, 28, 68, 0.9), rgba(40, 20, 80, 0.9));
border: 1px solid rgba(255,255,255,0.08);
box-shadow: 0 16px 48px rgba(80,40,255,0.35), 0 0 0 1px rgba(255,255,255,0.03) inset;
display: flex;
align-items: center;
justify-content: center;
margin-bottom: clamp(12px, 3vmin, 20px);
position: relative;
overflow: hidden;
}
.logo-box::after {
content: '';
position: absolute;
top: 0; left: 0; right: 0;
height: 45%;
background: linear-gradient(to bottom, rgba(255,255,255,.14), transparent);
border-radius: 22px 22px 0 0;
}
.logo-g {
display: grid;
grid-template-columns: repeat(3, 13px);
grid-template-rows: repeat(3, 13px);
gap: 3px;
}
.lc { border-radius: 3px; }
.sys-pill {
display: inline-flex;
align-items: center;
gap: 7px;
background: rgba(255,255,255,.05);
border: 1px solid rgba(255,255,255,.1);
border-radius: 20px;
padding: 5px 12px 5px 9px;
font-size: .62rem;
font-weight: 700;
letter-spacing: 1.5px;
text-transform: uppercase;
color: rgba(255,255,255,.38);
margin-bottom: 14px;
}
.sys-dot {
width: 7px; height: 7px;
border-radius: 50%;
background: var(--green);
box-shadow: 0 0 7px var(--green);
animation: blink 2.2s ease infinite;
}
@keyframes blink { 0%,100%{opacity:1;} 50%{opacity:.35;} }
.brand-t {
font-family: var(--f-display);
font-size: clamp(3rem, 13vw, 5.2rem);
font-weight: 900;
letter-spacing: -3px;
line-height: .88;
margin-bottom: 8px;
background: linear-gradient(135deg, var(--purple) 0%, var(--pink) 35%, var(--blue) 70%, var(--cyan) 100%);
background-size: 200% auto;
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
background-clip: text;
animation: shimmer 5s linear infinite;
}
@keyframes shimmer { to { background-position: 200% center; } }
.brand-by { font-size: .78rem; letter-spacing: 3px; text-transform: uppercase; color: rgba(255,255,255,.26); margin-bottom: 2px; }
.brand-n { font-family: var(--f-display); font-size: clamp(1.1rem, 3.5vmin, 1.4rem); font-weight: 600; color: rgba(255,255,255,.72); margin-bottom: 6px; }
.brand-tag { font-size: clamp(.74rem, 2vmin, .85rem); color: rgba(255,255,255,.3); line-height: 1.55; max-width: 240px; }
.l-stats {
display: grid;
grid-template-columns: 1fr 1fr 1fr;
gap: clamp(6px, 1.5vmin, 10px);
width: 100%;
margin-bottom: clamp(14px, 3.5vmin, 22px);
}
.ls {
background: var(--surface-light);
border: 1px solid var(--glass-border);
border-radius: 16px;
padding: clamp(8px, 2vmin, 13px) 8px;
text-align: center;
}
.ls-l { font-size: clamp(.5rem, 1.3vmin, .58rem); letter-spacing: 1.2px; text-transform: uppercase; color: rgba(255,255,255,.32); margin-bottom: 3px; }
.ls-v { font-family: var(--f-display); font-size: clamp(.95rem, 2.8vmin, 1.2rem); font-weight: 800; font-variant-numeric: tabular-nums; }
.mode-g { width: 100%; margin-bottom: clamp(14px, 3.5vmin, 20px); }
.mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: clamp(6px, 1.5vmin, 10px); }
.mc {
background: rgba(28, 28, 48, 0.4);
border: 1px solid var(--glass-border);
border-radius: 18px;
padding: clamp(10px, 2.5vmin, 15px) 10px;
text-align: center;
cursor: pointer;
transition: background .15s var(--spring), border-color .15s, transform .12s var(--spring);
-webkit-user-select: none;
user-select: none;
}
.mc:active { transform: scale(.97); }
.mc.on {
background: rgba(0,122,255,0.15);
border-color: rgba(0,122,255,0.35);
box-shadow: 0 0 0 1px rgba(0,122,255,0.12) inset, 0 8px 32px rgba(0,122,255,0.15);
}
.mc .mi { font-size: 1.3rem; display: block; margin-bottom: 4px; }
.mc .mn { font-size: clamp(.68rem, 1.9vmin, .78rem); font-weight: 700; color: rgba(255,255,255,.66); }
.mc .md { font-size: clamp(.54rem, 1.4vmin, .62rem); color: rgba(255,255,255,.28); margin-top: 1px; }
.mc.on .mn { color: #fff; }
.l-ctas { width: 100%; display: flex; flex-direction: column; gap: 10px; margin-bottom: clamp(16px, 4vmin, 24px); }
.l-foot { text-align: center; margin-top: 4px; }
.lf1 { font-size: .61rem; letter-spacing: 1.8px; text-transform: uppercase; color: rgba(255,255,255,.17); }
.lf1 a { color: rgba(255,255,255,.28); text-decoration: none; font-weight: 600; }
.lf2 { font-size: .56rem; color: rgba(255,255,255,.1); margin-top: 2px; }
#s2 {
background: rgba(0,0,0,.78);
backdrop-filter: blur(10px);
-webkit-backdrop-filter: blur(10px);
justify-content: flex-end;
}
.m-sheet {
background: #141428;
border-radius: 24px 24px 0 0;
border: 1px solid rgba(255,255,255,.1);
border-bottom: none;
max-height: 92dvh;
max-height: 92vh;
display: flex;
flex-direction: column;
box-shadow: 0 -20px 60px rgba(0,0,0,.9);
transform: translateY(100%);
transition: transform .38s var(--spring);
will-change: transform;
}
#s2.on .m-sheet { transform: translateY(0); }
.mh { width: 36px; height: 4px; border-radius: 2px; background: rgba(255,255,255,.18); margin: 10px auto 0; flex-shrink: 0; }
.mhd { display: flex; align-items: center; justify-content: space-between; padding: 12px 18px; flex-shrink: 0; border-bottom: 1px solid rgba(255,255,255,.07); }
.mhd-t { font-family: var(--f-display); font-size: .95rem; font-weight: 700; }
.mhd-x { width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,.09); border: none; color: #fff; font-size: .85rem; display: flex; align-items: center; justify-content: center; cursor: pointer; font-family: var(--f-body); }
.mb { overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 16px 18px calc(20px + var(--sab)); flex: 1; scrollbar-width: thin; scrollbar-color: rgba(255,255,255,.1) transparent; }
.mb::-webkit-scrollbar { width: 3px; }
.mb::-webkit-scrollbar-thumb { background: rgba(255,255,255,.1); border-radius: 2px; }
.mf { padding: 12px 18px calc(12px + var(--sab)); border-top: 1px solid rgba(255,255,255,.07); flex-shrink: 0; }
.mhero { background: linear-gradient(135deg, rgba(0,122,255,.12), rgba(175,82,222,.12)); border: 1px solid rgba(255,255,255,.07); border-radius: 16px; padding: 20px 16px; text-align: center; margin-bottom: 20px; }
.mhero-t { font-family: var(--f-display); font-size: 1.5rem; font-weight: 900; letter-spacing: -1px; background: linear-gradient(90deg, var(--cyan), var(--blue), var(--indigo)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px; }
.mhero-s { font-size: .77rem; color: rgba(255,255,255,.38); line-height: 1.55; }
.msec { margin-bottom: 20px; }
.mcard { background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.07); border-radius: 14px; overflow: hidden; }
.mrow { display: flex; align-items: flex-start; gap: 12px; padding: 12px 14px; border-bottom: 1px solid rgba(255,255,255,.04); }
.mrow:last-child { border-bottom: none; }
.mico { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.05rem; flex-shrink: 0; }
.mtxt h4 { font-size: .84rem; font-weight: 600; margin-bottom: 2px; font-family: var(--f-display); }
.mtxt p { font-size: .72rem; color: rgba(255,255,255,.4); line-height: 1.55; }
.stbl { background: rgba(255,255,255,.03); border: 1px solid rgba(255,255,255,.07); border-radius: 14px; overflow: hidden; }
.srow { display: flex; justify-content: space-between; align-items: center; padding: 9px 14px; border-bottom: 1px solid rgba(255,255,255,.04); }
.srow:last-child { border-bottom: none; }
.sn { font-size: .8rem; color: rgba(255,255,255,.64); }
.sp { font-size: .76rem; font-weight: 700; color: var(--cyan); font-variant-numeric: tabular-nums; }
.tip { background: rgba(0,122,255,.08); border: 1px solid rgba(0,122,255,.15); border-radius: 13px; padding: 12px 14px; display: flex; gap: 10px; margin-bottom: 8px; }
.tip:last-child { margin-bottom: 0; }
.tii { font-size: .95rem; flex-shrink: 0; margin-top: 1px; }
.tip p { font-size: .73rem; color: rgba(255,255,255,.46); line-height: 1.55; }
.tip p strong { color: rgba(255,255,255,.82); font-weight: 600; }
#s3 { background: var(--bg); overflow: hidden !important; }
#hud { display: flex; align-items: center; gap: 8px; padding: calc(var(--sat) + clamp(2px, .5vmin, 4px)) clamp(6px, 1.5vmin, 12px) clamp(3px, .7vmin, 5px); flex-shrink: 0; }
.hp { flex: 1; text-align: center; background: var(--surface-light); border: 1px solid var(--glass-border); border-radius: 14px; padding: 6px 8px; min-width: 0; }
.hp-l { font-size: clamp(.42rem, 1.1vmin, .52rem); font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,0.45); line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.hp-v { font-family: var(--f-display); font-size: clamp(.78rem, 2.2vmin, 1rem); font-weight: 800; font-variant-numeric: tabular-nums; letter-spacing: -.5px; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
#hsc .hp-v { color: var(--cyan); }
#hli .hp-v { color: var(--green); }
#hlv .hp-v { color: var(--yellow); }
#hhi .hp-v { color: var(--orange); }
.hpb { width: clamp(28px, 7vmin, 36px); height: clamp(28px, 7vmin, 36px); border-radius: 9px; flex-shrink: 0; background: var(--surface-light); border: 1px solid var(--glass-border); color: rgba(255,255,255,.5); font-size: clamp(.7rem, 2vmin, .85rem); cursor: pointer; display: flex; align-items: center; justify-content: center; font-family: var(--f-body); }
.hpb:active { background: rgba(255,255,255,.12); }
#gmain { flex: 1; min-height: 0; display: flex; align-items: flex-start; padding: clamp(2px, .5vmin, 5px) clamp(4px, 1vmin, 10px); gap: clamp(3px, .7vmin, 6px); position: relative; overflow: hidden; }
.gside { width: clamp(42px, 11vmin, 64px); flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; }
.gbox { background: var(--surface); border: 1px solid var(--glass-border); border-radius: 16px; padding: clamp(3px, .7vmin, 6px) clamp(2px, .5vmin, 5px); display: flex; flex-direction: column; align-items: center; gap: 3px; backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur); }
.gbl { font-size: clamp(.4rem, 1vmin, .5rem); font-weight: 700; letter-spacing: 1.2px; text-transform: uppercase; color: rgba(255,255,255,.32); }
.gcv { display: block; }
#bwrap { flex: 1; min-height: 0; height: 100%; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
#board { position: relative; border: 1px solid rgba(0,170,255,0.12); border-radius: 10px; overflow: hidden; box-shadow: 0 0 0 1px rgba(0,170,255,0.03), 0 0 32px rgba(0,30,100,0.2), inset 0 0 32px rgba(0,0,0,0.5); will-change: transform; }
#gcvs { display: block; }
.fb { position: absolute; pointer-events: none; z-index: 30; font-weight: 900; letter-spacing: -.5px; font-family: var(--f-display); }
.fb-pts { font-size: clamp(.8rem, 2.2vmin, 1rem); animation: fbUp .85s var(--ease-out) forwards; }
@keyframes fbUp { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-52px) scale(1.25); } }
.fb-combo { font-size: clamp(.95rem, 2.8vmin, 1.2rem); color: var(--yellow); text-shadow: 0 0 14px var(--yellow); animation: fbPop .85s var(--spring) forwards; left: 50%; transform: translateX(-50%); white-space: nowrap; }
@keyframes fbPop { 0% { opacity: 0; transform: translateX(-50%) scale(.2); } 30% { opacity: 1; transform: translateX(-50%) scale(1.1); } 100% { opacity: 0; transform: translateX(-50%) scale(1) translateY(-22px); } }
.fb-tspin, .fb-ac, .fb-lv { font-size: clamp(.62rem, 1.7vmin, .75rem); padding: 3px 11px; border-radius: 20px; color: #fff; animation: fbSlide 1.1s var(--spring) forwards; left: 50%; transform: translateX(-50%); white-space: nowrap; }
.fb-tspin { background: linear-gradient(90deg, var(--purple), var(--pink)); }
.fb-ac { background: linear-gradient(90deg, var(--green), var(--teal)); box-shadow: 0 0 22px rgba(52,199,89,.45); font-size: clamp(.68rem, 1.9vmin, .82rem); letter-spacing: 1.5px; top: 18%; }
.fb-lv { background: linear-gradient(90deg, var(--blue), var(--indigo)); box-shadow: 0 0 22px rgba(0,122,255,.4); letter-spacing: 2px; top: 30%; }
@keyframes fbSlide { 0% { opacity: 0; transform: translateX(-50%) translateY(8px); } 20% { opacity: 1; transform: translateX(-50%) translateY(0); } 75% { opacity: 1; } 100% { opacity: 0; transform: translateX(-50%) translateY(-16px); } }
@keyframes bShake { 0%,100% { transform: translateX(0); } 20% { transform: translateX(-5px); } 40% { transform: translateX(5px); } 60% { transform: translateX(-3px); } 80% { transform: translateX(3px); } }
.shk { animation: bShake .28s ease-out; }
#gctrl { flex-shrink: 0; padding: clamp(3px, .7vmin, 5px) clamp(6px, 1.5vmin, 10px) calc(var(--sab) + clamp(4px, 1vmin, 8px)); display: flex; flex-direction: column; gap: clamp(3px, .7vmin, 6px); }
.crow { display: flex; gap: clamp(3px, .7vmin, 6px); justify-content: center; }
.gb { border: none; border-radius: clamp(11px, 2.8vmin, 15px); color: #fff; font-weight: 800; font-size: clamp(.95rem, 2.8vmin, 1.2rem); font-family: var(--f-body); display: flex; align-items: center; justify-content: center; cursor: pointer; height: clamp(44px, 11vmin, 60px); background: rgba(28, 28, 48, 0.8); border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 1px 0 rgba(255,255,255,0.04) inset, 0 4px 0 rgba(0,0,0,0.5), 0 8px 20px rgba(0,0,0,0.3); transition: transform .07s, box-shadow .07s; -webkit-user-select: none; user-select: none; position: relative; overflow: hidden; will-change: transform; }
.gb::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 42%; background: linear-gradient(to bottom, rgba(255,255,255,.04), transparent); pointer-events: none; }
.gb:active { transform: translateY(4px); box-shadow: 0 0 0 rgba(0,0,0,0); }
.gb-hl { flex: 1.4; font-size: clamp(.58rem, 1.6vmin, .72rem); letter-spacing: 1px; background: linear-gradient(135deg, #7B3FF2 0%, #5B2DC9 100%); border-color: rgba(123, 63, 242, 0.4); }
.gb-rl, .gb-rr { width: clamp(44px, 11vmin, 58px); flex-shrink: 0; background: linear-gradient(135deg, #1E3A5F 0%, #0F2440 100%); border-color: rgba(30, 58, 95, 0.5); }
.gb-hd { width: clamp(44px, 11vmin, 58px); flex-shrink: 0; background: linear-gradient(135deg, #D4A017 0%, #B8860B 100%); border-color: rgba(212, 160, 23, 0.5); color: #fff; }
.gb-le, .gb-ri { width: clamp(44px, 11vmin, 58px); flex-shrink: 0; background: linear-gradient(135deg, #1E3A5F 0%, #0F2440 100%); border-color: rgba(30, 58, 95, 0.5); }
.gb-dn { width: clamp(44px, 11vmin, 58px); flex-shrink: 0; background: linear-gradient(135deg, #0A3D62 0%, #052842 100%); border-color: rgba(10, 61, 98, 0.5); }
.gb-ps { width: 100%; height: clamp(30px, 7.5vmin, 38px); border-radius: clamp(9px, 2.2vmin, 12px); font-size: clamp(.56rem, 1.5vmin, .68rem); letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,.35); background: var(--surface-light); border: 1px solid var(--glass-border); }
.hint { text-align: center; font-size: clamp(.46rem, 1.2vmin, .56rem); letter-spacing: 1px; color: rgba(255,255,255,.15); text-transform: uppercase; padding: 2px 0; }
#ow { display: none; position: fixed; inset: 0; z-index: 9999; background: rgba(5,5,15,.98); flex-direction: column; align-items: center; justify-content: center; gap: 16px; text-align: center; padding: 32px; }
.ow-ico { font-size: 3rem; animation: ri 2s ease infinite; }
@keyframes ri { 0%,100%{transform:rotate(0);} 50%{transform:rotate(-90deg);} }
.ow-txt { font-size: .9rem; color: rgba(255,255,255,.5); line-height: 1.6; }
.ow-txt strong { color: #fff; display: block; font-size: 1.1rem; margin-bottom: 4px; }
@media (max-height:500px) and (orientation:landscape) { #ow { display: flex; } }
#s4 { background: rgba(0,0,0,.86); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); align-items: center; justify-content: center; padding: 24px; }
.pcard { width: 100%; max-width: 300px; border-radius: 22px; padding: clamp(22px, 5.5vmin, 32px) 20px; display: flex; flex-direction: column; align-items: center; gap: 14px; background: rgb(18,18,34); backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px); border: 1px solid var(--glass-border); box-shadow: 0 1px 0 var(--glass-shine) inset, 0 20px 60px rgba(0,0,0,.5); }
.pt { font-family: var(--f-display); font-size: 2rem; font-weight: 900; letter-spacing: -1.5px; color: var(--blue); text-shadow: 0 0 28px rgba(0,122,255,.4); }
.ps-w { text-align: center; }
.ps-l { font-size: .57rem; letter-spacing: 1.2px; text-transform: uppercase; color: rgba(255,255,255,.27); }
.ps-v { font-family: var(--f-display); font-size: 1.9rem; font-weight: 900; font-variant-numeric: tabular-nums; }
.pr { width: 100%; padding: 15px; border: none; border-radius: 13px; background: linear-gradient(135deg, var(--blue), var(--indigo)); font-size: .95rem; font-weight: 700; font-family: var(--f-body); color: #fff; cursor: pointer; box-shadow: 0 4px 18px rgba(0,122,255,.34); transition: transform .12s var(--spring); }
.pr:active { transform: scale(.97); }
.pq { width: 100%; padding: 13px; border-radius: 12px; cursor: pointer; background: rgba(255,59,48,.1); border: 1px solid rgba(255,59,48,.22); font-size: .85rem; font-weight: 600; color: rgba(255,59,48,.8); font-family: var(--f-body); transition: background .12s; }
.pq:active { background: rgba(255,59,48,.18); }
#s5 { background: radial-gradient(ellipse at 50% 0%, rgba(40,4,4,.97) 0%, rgba(6,5,15,.99) 100%); }
.go-w { max-width: 380px; margin: 0 auto; padding: calc(var(--sat) + clamp(16px, 4vmin, 24px)) 20px calc(var(--sab) + 30px); display: flex; flex-direction: column; align-items: center; gap: 0; min-height: 100%; }
.go-e { font-size: clamp(2.2rem, 8vmin, 3rem); margin-bottom: 8px; animation: bIn .5s var(--spring) .1s both; }
@keyframes bIn { from{transform:scale(0) rotate(-15deg);} to{transform:scale(1) rotate(0);} }
.go-t { font-family: var(--f-display); font-size: clamp(2.4rem, 10vw, 4rem); font-weight: 900; letter-spacing: -2.5px; text-align: center; line-height: .9; margin-bottom: 10px; color: var(--red); text-shadow: 0 0 45px rgba(255,59,48,.35); animation: bIn .4s var(--spring) .2s both; }
.go-q { font-size: clamp(.78rem, 2.2vmin, .92rem); color: rgba(255,255,255,.44); text-align: center; line-height: 1.65; margin-bottom: clamp(16px, 4vmin, 24px); font-style: italic; padding: 0 6px; animation: fUp .5s var(--ease-out) .45s both; }
@keyframes fUp { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
.go-sb { width: 100%; background: rgba(255,59,48,.07); border: 1px solid rgba(255,59,48,.18); border-radius: 16px; padding: clamp(12px, 3vmin, 18px); text-align: center; margin-bottom: 14px; animation: fUp .4s var(--ease-out) .32s both; }
.go-sb .gl { font-size: .57rem; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,.26); }
.go-sb .gv { font-family: var(--f-display); font-size: clamp(2rem, 6.5vmin, 2.8rem); font-weight: 900; letter-spacing: -2px; font-variant-numeric: tabular-nums; }
#nrec { display: none; font-family: var(--f-display); font-size: .84rem; font-weight: 800; letter-spacing: 1px; color: var(--yellow); text-shadow: 0 0 12px var(--yellow); text-align: center; margin-bottom: 12px; animation: rpulse 1.5s ease infinite; }
@keyframes rpulse { 0%,100%{opacity:1;} 50%{opacity:.6;} }
.go-st { width: 100%; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: clamp(6px, 1.5vmin, 10px); margin-bottom: clamp(14px, 3.5vmin, 20px); animation: fUp .4s var(--ease-out) .55s both; }
.go-s { background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.07); border-radius: 13px; padding: clamp(8px, 2vmin, 13px) 6px; text-align: center; }
.go-sl { font-size: clamp(.48rem, 1.3vmin, .57rem); letter-spacing: 1px; text-transform: uppercase; color: rgba(255,255,255,.26); margin-bottom: 2px; }
.go-sv { font-family: var(--f-display); font-size: clamp(1rem, 3vmin, 1.3rem); font-weight: 800; font-variant-numeric: tabular-nums; }
.go-ct { width: 100%; display: flex; flex-direction: column; gap: 9px; animation: fUp .4s var(--ease-out) .65s both; }
#s6 { background: radial-gradient(ellipse at 50% 100%, rgba(0,18,8,.98) 0%, rgba(5,5,15,.99) 60%); }
.fw-w { max-width: 360px; margin: 0 auto; padding: calc(var(--sat) + clamp(20px, 5vmin, 32px)) 20px calc(var(--sab) + 34px); display: flex; flex-direction: column; align-items: center; gap: 0; min-height: 100%; }
.fw-e { font-size: clamp(2.4rem, 8vmin, 3.2rem); margin-bottom: 12px; animation: bIn .5s var(--spring) .1s both; }
.fw-t { font-family: var(--f-display); font-size: clamp(1.6rem, 5.5vmin, 2.2rem); font-weight: 900; letter-spacing: -1.5px; text-align: center; margin-bottom: 8px; color: var(--green); text-shadow: 0 0 35px rgba(52,199,89,.3); animation: fUp .4s var(--ease-out) .2s both; }
.fw-q { font-size: clamp(.78rem, 2.2vmin, .92rem); color: rgba(255,255,255,.43); text-align: center; line-height: 1.65; margin-bottom: 24px; font-style: italic; padding: 0 6px; animation: fUp .4s var(--ease-out) .32s both; }
.fw-q strong { color: rgba(255,255,255,.78); font-style: normal; font-weight: 600; }
.fw-hb { width: 100%; background: rgba(52,199,89,.07); border: 1px solid rgba(52,199,89,.15); border-radius: 16px; padding: 16px; text-align: center; margin-bottom: 22px; animation: fUp .4s var(--ease-out) .42s both; }
.fw-hl { font-size: .57rem; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,.25); }
.fw-hv { font-family: var(--f-display); font-size: clamp(1.8rem, 6vmin, 2.5rem); font-weight: 900; letter-spacing: -2px; font-variant-numeric: tabular-nums; }
.fw-ct { width: 100%; display: flex; flex-direction: column; gap: 9px; animation: fUp .4s var(--ease-out) .52s both; }
.fw-cr { margin-top: auto; padding-top: 26px; text-align: center; animation: fUp .4s var(--ease-out) .62s both; }
.fw-c1 { font-size: .6rem; letter-spacing: 1.8px; text-transform: uppercase; color: rgba(255,255,255,.15); }
.fw-c1 a { color: rgba(255,255,255,.26); text-decoration: none; font-weight: 600; }
.fw-c2 { font-size: .55rem; color: rgba(255,255,255,.09); margin-top: 2px; }
#countdown { position: absolute; inset: 0; z-index: 50; background: rgba(5,5,15,.92); display: none; align-items: center; justify-content: center; flex-direction: column; gap: 8px; }
#countdown.on { display: flex; }
#cd-num { font-family: var(--f-display); font-size: clamp(4rem, 18vmin, 7rem); font-weight: 900; color: var(--cyan); text-shadow: 0 0 80px rgba(10, 132, 255, 0.6); animation: cdPop .35s var(--spring); }
#cd-label { font-size: clamp(.7rem, 2vmin, .9rem); color: rgba(255,255,255,.35); text-transform: uppercase; letter-spacing: 3px; font-weight: 600; }
@keyframes cdPop { from { transform: scale(2.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
#near-rec { position: absolute; top: 0; left: 0; right: 0; z-index: 40; text-align: center; padding: 2px; font-size: .6rem; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; color: var(--orange); background: linear-gradient(90deg, transparent, rgba(255,159,10,0.12), transparent); opacity: 0; transition: opacity .3s; pointer-events: none; }
#near-rec.on { opacity: 1; animation: nearPulse 1.2s ease infinite; }
@keyframes nearPulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
#challenge-hud { position: absolute; bottom: 0; left: 0; right: 0; z-index: 40; text-align: center; padding: 3px 8px; font-size: .55rem; font-weight: 600; color: rgba(255,255,255,.3); background: linear-gradient(0deg, rgba(5,5,15,.6), transparent); pointer-events: none; display: none; }
#challenge-hud.on { display: block; }
.hp.glow-rec { border-color: rgba(255,149,0,.5); box-shadow: 0 0 12px rgba(255,149,0,.2); }
#board.near-glow { border-color: rgba(255,149,0,.4); box-shadow: 0 0 0 1px rgba(255,149,0,.15), 0 0 55px rgba(255,100,0,.15), inset 0 0 35px rgba(0,0,0,.5); }
.fb-msg { font-size: clamp(.56rem, 1.5vmin, .68rem); padding: 3px 11px; border-radius: 20px; color: #fff; background: linear-gradient(90deg, rgba(255,255,255,.12), rgba(255,255,255,.06)); border: 1px solid rgba(255,255,255,.12); animation: fbSlide 1.1s var(--spring) forwards; left: 50%; transform: translateX(-50%); white-space: nowrap; }
#go-delta { font-size: .76rem; font-weight: 700; text-align: center; margin-bottom: clamp(10px, 2.5vmin, 16px); min-height: 1.1em; animation: fUp .4s var(--ease-out) .52s both; }
#go-hook { font-size: .68rem; color: rgba(255,255,255,.3); text-align: center; margin-bottom: 14px; animation: fUp .4s var(--ease-out) .6s both; }
#kb-hints { display: none; }
#desk-stats { display: none; }
.ptc { position: fixed; border-radius: 50%; pointer-events: none; z-index: 999; animation: ptcF .7s ease-out forwards; }
@keyframes ptcF { 0% { opacity: 1; transform: translate(0, 0) scale(1); } 100% { opacity: 0; transform: translate(var(--px), var(--py)) scale(0); } }
@keyframes scorePop { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
.score-pop { animation: scorePop .2s var(--spring); }
@media (max-width: 360px) {
.brand-t { font-size: 2.6rem; letter-spacing: -2px; }
.hint { display: none; }
.gside { width: 40px; }
.gbl { font-size: .38rem; }
.hp { padding: 2px 2px; }
.hp-l { font-size: .4rem; letter-spacing: .5px; }
.hp-v { font-size: .72rem; }
.hpb { width: 26px; height: 26px; font-size: .65rem; }
}
@media (max-width: 375px) and (min-width: 361px) { .gside { width: 44px; } }
@media (min-width: 376px) and (max-width: 414px) { .gside { width: 50px; } }
@media (min-width: 415px) { .gside { width: 56px; } }
@media (min-width: 600px) {
.l-wrap { padding-top: calc(var(--sat) + 36px); }
.mode-grid, .l-ctas, .l-stats { max-width: 420px; margin-left: auto; margin-right: auto; }
.gside { width: 64px; }
}
@media (min-width: 768px) {
.gside { width: 72px; }
.pcard { max-width: 340px; }
.m-sheet { max-width: 600px; margin: 0 auto; border-radius: 24px 24px 0 0; }
}
@media (min-width: 1024px) {
.l-wrap { max-width: 600px; }
.gside { width: 80px; }
#gmain { padding: 6px 16px; gap: 8px; }
#gctrl { padding: 6px 16px calc(var(--sab) + 8px); gap: 6px; }
.crow { gap: 6px; }
}
@media (max-width: 480px) and (min-height: 800px) {
#gctrl { padding-bottom: calc(var(--sab) + 12px); }
.crow { gap: 5px; }
}
@media (max-height: 650px) and (max-width: 480px) {
.hint { display: none; }
.gb-ps { height: 26px; font-size: .5rem; }
#hud { padding-top: calc(var(--sat) + 1px); padding-bottom: 2px; }
.hp { padding: 2px 2px; border-radius: 7px; }
.hp-l { display: none; }
}
@supports (padding-top: env(safe-area-inset-top)) {
#hud { padding-top: calc(env(safe-area-inset-top, 0px) + clamp(2px, .5vmin, 4px)); }
#gctrl { padding-bottom: calc(env(safe-area-inset-bottom, 0px) + clamp(4px, 1vmin, 8px)); }
}
@media (min-width: 1200px) and (hover: hover) and (pointer: fine) {
#gctrl { display: none !important; }
.hint { display: none !important; }
#kb-hints { display: flex; flex-direction: column; gap: 5px; margin-top: 8px; }
.kh-row { display: flex; align-items: center; gap: 8px; font-size: .68rem; color: rgba(255,255,255,.35); }
.kh-key { background: rgba(255,255,255,.07); border: 1px solid rgba(255,255,255,.12); border-radius: 6px; padding: 3px 8px; font-size: .6rem; font-weight: 700; color: rgba(255,255,255,.5); font-family: var(--f-body); min-width: 28px; text-align: center; }
.gside { width: 100px !important; }
.gbox { padding: 8px 6px; }
.gbl { font-size: .55rem; }
#gmain { padding: 8px 24px; gap: 12px; align-items: center; }
#desk-stats { display: flex !important; flex-direction: column; gap: 6px; width: 140px; flex-shrink: 0; }
.ds-card { background: rgba(255,255,255,.04); border: 1px solid rgba(255,255,255,.07); border-radius: 12px; padding: 10px; text-align: center; }
.ds-l { font-size: .5rem; font-weight: 700; letter-spacing: 1.2px; text-transform: uppercase; color: rgba(255,255,255,.22); margin-bottom: 3px; }
.ds-v { font-family: var(--f-display); font-size: 1rem; font-weight: 800; font-variant-numeric: tabular-nums; }
.m-sheet { max-width: 560px; margin: 0 auto; border-radius: 20px; max-height: 80vh; border-bottom: 1px solid rgba(255,255,255,.1); }
#s2 { justify-content: center; align-items: center; }
.l-wrap { max-width: 560px; }
.pcard { max-width: 380px; }
}
</style>
</head>
<body>
<div id="amb" aria-hidden="true">
<div class="orb" style="width:340px;height:340px;top:-80px;left:-60px;background:radial-gradient(circle,rgba(0,60,200,.36),transparent 70%);animation-duration:24s;opacity:.4;"></div>
<div class="orb" style="width:300px;height:300px;bottom:-50px;right:-40px;background:radial-gradient(circle,rgba(120,0,220,.3),transparent 70%);animation-duration:30s;animation-delay:-10s;opacity:.35;"></div>
<div class="orb" style="width:200px;height:200px;top:42%;left:16%;background:radial-gradient(circle,rgba(0,150,200,.18),transparent 70%);animation-duration:20s;animation-delay:-6s;opacity:.38;"></div>
</div>
<div id="lf" aria-hidden="true"></div>
<div id="ow" role="alert" aria-live="assertive">
<div class="ow-ico" aria-hidden="true">üì±</div>
<div class="ow-txt"><strong>Gira tu dispositivo</strong>Tetris funciona mejor en modo vertical.</div>
</div>
<div id="app">
<div class="scr on" id="s1" role="main">
<canvas id="rain" aria-hidden="true"></canvas>
<div class="sw">
<div class="l-wrap">
<div class="brand">
<div class="logo-box" aria-hidden="true"><div class="logo-g" id="lgrid"></div></div>
<div class="sys-pill"><div class="sys-dot"></div>Explicalia System</div>
<h1 class="brand-t">TETRIS</h1>
<div class="brand-by">por</div>
<div class="brand-n">Explicalia</div>
<p class="brand-tag">Siete piezas. Infinitas decisiones.<br>¬øCu√°ntas l√≠neas aguantas?</p>
<div id="l-challenge"></div>
</div>
<div id="l-rank" class="rank-badge" style="display:none"><span class="rank-ico"></span><span id="l-rank-t"></span></div>
<div id="l-streak"></div>
<div class="l-stats" role="group" aria-label="Estad√≠sticas">
<div class="ls"><div class="ls-l">Tu r√©cord</div><div class="ls-v" id="l-hi" style="color:var(--orange)">‚Äî</div></div>
<div class="ls"><div class="ls-l">Partidas</div><div class="ls-v" id="l-gm" style="color:var(--purple)">‚Äî</div></div>
<div class="ls"><div class="ls-l">L√≠neas totales</div><div class="ls-v" id="l-li" style="color:var(--green)">‚Äî</div></div>
</div>
<div class="mode-g" role="radiogroup" aria-label="Modo de juego">
<div class="slbl">Elige tu desaf√≠o</div>
<div class="mode-grid">
<div class="mc on" data-m="marathon" role="radio" aria-checked="true" tabindex="0" onclick="UI.mode(this,'marathon')"><span class="mi" aria-hidden="true">‚ôæ</span><div class="mn">Marat√≥n</div><div class="md">Sobrevive. Sube. Domina.</div></div>
<div class="mc" data-m="sprint" role="radio" aria-checked="false" tabindex="0" onclick="UI.mode(this,'sprint')"><span class="mi" aria-hidden="true">‚ö°</span><div class="mn">Sprint 40L</div><div class="md">40 l√≠neas. Sin excusas.</div></div>
<div class="mc" data-m="ultra" role="radio" aria-checked="false" tabindex="0" onclick="UI.mode(this,'ultra')"><span class="mi" aria-hidden="true">‚è±</span><div class="mn">Ultra 2min</div><div class="md">120 segundos. Cada bloque cuenta.</div></div>
<div class="mc" data-m="blitz" role="radio" aria-checked="false" tabindex="0" onclick="UI.mode(this,'blitz')"><span class="mi" aria-hidden="true">üî•</span><div class="mn">Blitz 3min</div><div class="md">La velocidad no perdona.</div></div>
</div>
</div>
<div class="l-ctas">
<button class="btn" onclick="UI.play()" aria-label="Empezar partida">Empezar partida</button>
<button class="btn ghost" onclick="UI.openManual()" aria-label="Domina los controles">Domina los controles</button>
</div>
<footer class="l-foot">
<div class="lf1">Un juego de <a href="https://www.explicalia.com" target="_blank" rel="noopener">explicalia.com</a></div>
<div class="lf2">¬© 2025 Explicalia System ¬∑ Todos los derechos reservados</div>
</footer>
</div>
</div>
</div>
<div class="scr" id="s2" role="dialog" aria-label="Manual de juego">
<div class="m-sheet">
<div class="mh"></div>
<div class="mhd">
<div class="mhd-t">Manual de juego</div>
<button class="mhd-x" onclick="UI.closeManual()" aria-label="Cerrar manual">‚úï</button>
</div>
<div class="mb">
<div class="mhero">
<div class="mhero-t">Tetris ¬∑ Explicalia</div>
<div class="mhero-s">Siete piezas. Infinitas decisiones.<br>Todo lo que necesitas dominar.</div>
</div>
<div class="msec">
<div class="slbl">Controles ‚Äî Gestos sobre el tablero</div>
<div class="mcard">
<div class="mrow"><div class="mico" style="background:rgba(0,122,255,.14)">‚Üê‚Üí</div><div class="mtxt"><h4>Deslizar izquierda / derecha</h4><p>Mueve la pieza. Mant√©n pulsado para repetici√≥n autom√°tica (DAS 185ms, ARR 58ms).</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(0,122,255,.14)">‚Üì</div><div class="mtxt"><h4>Deslizar suave hacia abajo</h4><p>Soft drop: cae m√°s r√°pido. +1 punto por celda recorrida.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(255,208,0,.12)">‚¨á</div><div class="mtxt"><h4>Flick r√°pido hacia abajo</h4><p>Hard drop instant√°neo. +2 pts por celda. La jugada m√°s eficiente.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(175,82,222,.14)">‚Üë</div><div class="mtxt"><h4>Flick hacia arriba</h4><p>HOLD: guarda la pieza para usarla despu√©s. Solo una vez por turno.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(90,200,250,.14)">‚óÄ</div><div class="mtxt"><h4>Toque mitad izquierda del tablero</h4><p>Rota la pieza en sentido antihorario (CCW).</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(90,200,250,.14)">‚ñ∂</div><div class="mtxt"><h4>Toque mitad derecha del tablero</h4><p>Rota la pieza en sentido horario (CW). Sistema SRS oficial con wall kicks.</p></div></div>
</div>
</div>
<div class="msec">
<div class="slbl">Mec√°nicas avanzadas</div>
<div class="mcard">
<div class="mrow"><div class="mico" style="background:rgba(255,255,255,.05)">üëª</div><div class="mtxt"><h4>Ghost piece</h4><p>Silueta transparente que muestra d√≥nde caer√° la pieza. Imprescindible para jugar r√°pido.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(255,59,48,.1)">‚è≥</div><div class="mtxt"><h4>Lock Delay (500ms + parpadeo)</h4><p>Al tocar el suelo tienes 500ms para reposicionar. La pieza parpadea. Cada movimiento reinicia el contador (m√°x. 15 veces).</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(52,199,89,.12)">üîÑ</div><div class="mtxt"><h4>Sistema SRS completo</h4><p>5 wall kicks por rotaci√≥n. Las piezas se adaptan a espacios estrechos cerca de paredes.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(255,204,0,.1)">üåÄ</div><div class="mtxt"><h4>T-Spin</h4><p>Rota la T en un hueco cerrado. La jugada m√°s premium ‚Äî multiplica puntuaci√≥n dr√°sticamente.</p></div></div>
<div class="mrow"><div class="mico" style="background:rgba(0,212,232,.1)">üîó</div><div class="mtxt"><h4>Back-to-Back +50%</h4><p>Encadena Tetris o T-Spins consecutivos para un bono permanente del 50%.</p></div></div>
</div>
</div>
<div class="msec">
<div class="slbl">Tabla de puntuaci√≥n oficial</div>
<div class="stbl">
<div class="srow"><span class="sn">Single ‚Äî 1 l√≠nea</span><span class="sp">100 √ó nivel</span></div>
<div class="srow"><span class="sn">Double ‚Äî 2 l√≠neas</span><span class="sp">300 √ó nivel</span></div>
<div class="srow"><span class="sn">Triple ‚Äî 3 l√≠neas</span><span class="sp">500 √ó nivel</span></div>
<div class="srow"><span class="sn">‚ö° Tetris ‚Äî 4 l√≠neas</span><span class="sp">800 √ó nivel</span></div>
<div class="srow"><span class="sn">üåÄ T-Spin Single</span><span class="sp">800 √ó nivel</span></div>
<div class="srow"><span class="sn">üåÄ T-Spin Double</span><span class="sp">1 200 √ó nivel</span></div>
<div class="srow"><span class="sn">‚ú® All Clear</span><span class="sp">3 500 √ó nivel</span></div>
<div class="srow"><span class="sn">üîó Back-to-Back</span><span class="sp">√ó1.5 puntos</span></div>
<div class="srow"><span class="sn">üí• Combo (√ón)</span><span class="sp">50 √ó combo √ó nivel</span></div>
</div>
</div>
<div class="msec">
<div class="slbl">Estrategia pro</div>
<div class="tip"><div class="tii" aria-hidden="true">üéØ</div><p><strong>Pila plana siempre.</strong> Evita torres y columnas aisladas. Superficie uniforme = m√°s opciones.</p></div>
<div class="tip"><div class="tii" aria-hidden="true">üì¶</div><p><strong>Hold = seguro de vida.</strong> Guarda la S o Z cuando no encajan. √ösalas en el momento exacto.</p></div>
<div class="tip"><div class="tii" aria-hidden="true">üîµ</div><p><strong>7-Bag garantizado.</strong> Cada pieza aparece exactamente una vez cada 7. Planifica la I.</p></div>
<div class="tip" style="background:rgba(175,82,222,.09);border-color:rgba(175,82,222,.2)"><div class="tii" aria-hidden="true">üåÄ</div><p><strong>T-Spin supera a Tetris.</strong> Un T-Spin Double en nivel 10 vale m√°s que un Tetris en nivel 5.</p></div>
</div>
<div style="text-align:center;padding:6px 0 4px;"><div style="font-size:.55rem;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.12);">Dise√±ado por <a href="https://www.explicalia.com" style="color:rgba(255,255,255,.22);text-decoration:none;font-weight:600;" target="_blank" rel="noopener">Explicalia System</a></div></div>
</div>
<div class="mf"><button class="btn" onclick="UI.playFromManual()">Empezar a jugar</button></div>
</div>
</div>
</div>
<div class="scr" id="s3" role="application" aria-label="Tetris">
<div id="countdown"><div id="cd-num"></div><div id="cd-label"></div></div>
<div id="near-rec">‚Üí CERCA DEL R√âCORD ‚Üê</div>
<div id="hud">
<div class="hp" id="hsc"><div class="hp-l">Puntos</div><div class="hp-v" id="hv-sc">0</div></div>
<div class="hp" id="hli"><div class="hp-l">L√≠neas</div><div class="hp-v" id="hv-li">0</div></div>
<div class="hp" id="hlv"><div class="hp-l" id="hv-lbl">Nivel</div><div class="hp-v" id="hv-lv">1</div></div>
<div class="hp" id="hhi"><div class="hp-l">R√©cord</div><div class="hp-v" id="hv-hi">0</div></div>
<button class="hpb" onclick="G&&G.pause()" aria-label="Pausar">‚è∏</button>
</div>
<div id="gmain">
<div class="gside">
<div class="gbox">
<div class="gbl">HOLD</div>
<canvas class="gcv" id="cv-h" width="46" height="36" aria-label="Pieza guardada"></canvas>
</div>
<div id="kb-hints">
<div class="kh-row"><span class="kh-key">‚Üê ‚Üí</span> mover</div>
<div class="kh-row"><span class="kh-key">‚Üë</span> rotar</div>
<div class="kh-row"><span class="kh-key">SPC</span> drop</div>
<div class="kh-row"><span class="kh-key">C</span> hold</div>
<div class="kh-row"><span class="kh-key">ESC</span> pausa</div>
</div>
</div>
<div id="bwrap">
<div id="board">
<canvas id="gcvs" aria-label="Tablero de juego"></canvas>
</div>
</div>
<div class="gside">
<div class="gbox" style="height:auto;padding-bottom:7px;">
<div class="gbl" style="margin-bottom:3px;">NEXT</div>
<canvas class="gcv" id="cv-n" width="46" height="210" aria-label="Pr√≥ximas piezas"></canvas>
</div>
</div>
<div id="desk-stats">
<div class="ds-card"><div class="ds-l">Combo m√°x</div><div class="ds-v" id="ds-combo" style="color:var(--yellow)">0</div></div>
<div class="ds-card"><div class="ds-l">T-Spins</div><div class="ds-v" id="ds-tspin" style="color:var(--purple)">0</div></div>
<div class="ds-card"><div class="ds-l">Tetris</div><div class="ds-v" id="ds-tetris" style="color:var(--cyan)">0</div></div>
<div class="ds-card"><div class="ds-l">Racha</div><div class="ds-v" id="ds-streak" style="color:var(--orange)">0</div></div>
</div>
</div>
<div id="gctrl">
<div class="crow">
<button class="gb gb-hl" id="bt-hl" aria-label="Guardar pieza">HOLD</button>
<button class="gb gb-rl" id="bt-rl" aria-label="Rotar izquierda">‚Ü∫</button>
<button class="gb gb-rr" id="bt-rr" aria-label="Rotar derecha">‚Üª</button>
<button class="gb gb-hd" id="bt-hd" aria-label="Ca√≠da instant√°nea">‚¨á</button>
<button class="gb gb-le" id="bt-le" aria-label="Mover izquierda">‚Üê</button>
<button class="gb gb-dn" id="bt-dn" aria-label="Ca√≠da suave">‚Üì</button>
<button class="gb gb-ri" id="bt-ri" aria-label="Mover derecha">‚Üí</button>
</div>
<div class="crow">
<button class="gb gb-ps" onclick="G&&G.pause()" aria-label="Pausar juego">‚è∏ &nbsp; PAUSA</button>
</div>
<div class="hint" aria-hidden="true">desliza tablero ¬∑ toca izq/der para rotar ¬∑ flick r√°pido = hard drop</div>
</div>
</div>
<div class="scr" id="s4" role="dialog" aria-label="Pausa">
<div class="pcard">
<div class="pt">Pausa</div>
<div class="ps-w">
<div class="ps-l">Puntuaci√≥n actual</div>
<div class="ps-v" id="ps-v">0</div>
</div>
<button class="pr" onclick="G&&G.resume()">‚ñ∂ &nbsp; Continuar</button>
<button class="pq" onclick="UI.quitFarewell()">Salir del juego</button>
</div>
</div>
<div class="scr" id="s5" role="status" aria-label="Fin del juego">
<div class="sw">
<div class="go-w">
<div class="go-e" id="go-e" aria-hidden="true">üíÄ</div>
<div class="go-t">GAME<br>OVER</div>
<div class="go-q" id="go-q"></div>
<div id="go-delta"></div>
<div class="go-sb">
<div class="gl">Puntuaci√≥n final</div>
<div class="gv" id="go-sc">0</div>
</div>
<div id="nrec" aria-live="polite">‚ú¶ &nbsp; NUEVO R√âCORD &nbsp; ‚ú¶</div>
<div class="go-st">
<div class="go-s"><div class="go-sl">L√≠neas</div><div class="go-sv" id="go-li" style="color:var(--green)">0</div></div>
<div class="go-s"><div class="go-sl">Nivel</div><div class="go-sv" id="go-lv" style="color:var(--yellow)">1</div></div>
<div class="go-s"><div class="go-sl">R√©cord</div><div class="go-sv" id="go-hi" style="color:var(--orange)">0</div></div>
</div>
<div id="go-hook"></div>
<div class="go-ct">
<button class="btn red" onclick="UI.retry()">Revancha</button>
<button class="btn ghost" onclick="UI.toLanding()">Volver al men√∫</button>
</div>
</div>
</div>
</div>
<div class="scr" id="s6">
<div class="sw">
<div class="fw-w">
<div class="fw-e" id="fw-e" aria-hidden="true">üëã</div>
<div class="fw-t">Hasta la pr√≥xima</div>
<div class="fw-q" id="fw-q"></div>
<div class="fw-hb">
<div class="fw-hl">Tu mejor puntuaci√≥n hist√≥rica</div>
<div class="fw-hv" id="fw-hi">‚Äî</div>
</div>
<div class="fw-ct">
<button class="btn green" onclick="UI.play()">Una m√°s</button>
<button class="btn ghost" onclick="UI.toLanding()">Volver al inicio</button>
</div>
<div class="fw-cr">
<div class="fw-c1">Una experiencia de <a href="https://www.explicalia.com" target="_blank" rel="noopener">explicalia.com</a></div>
<div class="fw-c2">¬© 2025 Explicalia System</div>
</div>
</div>
</div>
</div>
</div>
<script>
'use strict';
const COLS = 10, ROWS = 20;
const SHP = {
I: { s: [[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]] },
O: { s: [[1,1],[1,1]] },
T: { s: [[0,1,0],[1,1,1],[0,0,0]] },
S: { s: [[0,1,1],[1,1,0],[0,0,0]] },
Z: { s: [[1,1,0],[0,1,1],[0,0,0]] },
J: { s: [[1,0,0],[1,1,1],[0,0,0]] },
L: { s: [[0,0,1],[1,1,1],[0,0,0]] }
};
const PC = { I:'#00E5FF', O:'#FFEA00', T:'#D500F9', S:'#00E676', Z:'#FF1744', J:'#2979FF', L:'#FF9100' };
const PG = { I:'rgba(0,229,255,0.85)', O:'rgba(255,234,0,0.85)', T:'rgba(213,0,249,0.85)', S:'rgba(0,230,118,0.85)', Z:'rgba(255,23,68,0.85)', J:'rgba(41,121,255,0.85)', L:'rgba(255,145,0,0.85)' };
const KN = [ [[0,0],[-1,0],[-1,1],[0,-2],[-1,-2]], [[0,0],[1,0],[1,-1],[0,2],[1,2]], [[0,0],[1,0],[1,1],[0,-2],[1,-2]], [[0,0],[-1,0],[-1,-1],[0,2],[-1,2]] ];
const KI = [ [[0,0],[-2,0],[1,0],[-2,-1],[1,2]], [[0,0],[-1,0],[2,0],[-1,2],[2,-1]], [[0,0],[2,0],[-1,0],[2,1],[-1,-2]], [[0,0],[1,0],[-2,0],[1,-2],[-2,1]] ];
const GV = [800, 720, 630, 550, 470, 380, 300, 220, 150, 100, 80, 70, 60, 55, 50];
const MILESTONES = [ {at:1,msg:'¬°As√≠ se empieza!'},{at:5,msg:'Calentando motores‚Ä¶'},{at:10,msg:'Esto se pone serio.'},{at:20,msg:'Nivel de veterano.'},{at:30,msg:'¬°M√°quina imparable!'},{at:40,msg:'Sprint completado‚Ä¶'} ];
const RANKS = [ {min:0,name:'Novato',ico:'üü¢'},{min:100,name:'Aprendiz',ico:'üîµ'},{min:500,name:'Estratega',ico:'üü£'},{min:1500,name:'Maestro',ico:'üü°'},{min:5000,name:'Leyenda',ico:'üî¥'},{min:15000,name:'Mito',ico:'üëë'} ];
function getRank(totalLines) { let r = RANKS[0]; for (const rk of RANKS) if (totalLines >= rk.min) r = rk; return r; }
let SESSION_STREAK = 0;
const GO_B = [ { e:'üíÄ', q:'Al menos ca√≠ste con estilo. Bueno‚Ä¶ casi.' },{ e:'ü§¶', q:'Llevas m√°s tiempo mirando la pantalla que jugando.' },{ e:'üò¨', q:'Eso fue‚Ä¶ algo. Definitivamente fue algo.' },{ e:'ü´†', q:'Tu pila de bloques te mand√≥ sus condolencias.' },{ e:'üòÖ', q:'Tranquilo. Las piezas tambi√©n se rinden a veces.' },{ e:'üß±', q:'Construiste una obra de arte. Solo que al rev√©s.' },{ e:'üéÆ', q:'Tetris te mand√≥ un tutorial. De regalo.' },{ e:'‚òï', q:'Quiz√°s un caf√© ayude. Probablemente no.' },{ e:'üèÜ', q:'R√©cord personal. De peor puntuaci√≥n, pero r√©cord.' },{ e:'üé≠', q:'Con ese juego no abras un canal de gaming.' } ];
const FW_B = [ { e:'üëã', q:'Salir ahora fue la decisi√≥n m√°s valiente del d√≠a. Tu pila te lo agradece.' },{ e:'üõã', q:'Los bloques seguir√°n aqu√≠ cuando vuelvas. Ellos no tienen ad√≥nde ir.' },{ e:'ü´°', q:'¬øYa te vas? La pieza I acababa de llegar. T√≠pico.' },{ e:'üé≠', q:'Hasta pronto. El tablero te guardar√° el sitio. Aunque ojal√° no lo necesites.' },{ e:'üö∂', q:'Salir a tiempo tambi√©n es una habilidad. L√°stima que dentro del juego no la tienes.' } ];
const DB = {
_get(k) { try { return localStorage.getItem(k); } catch(e) { return null; } },
_set(k, v) { try { localStorage.setItem(k, v); } catch(e) {} },
hi() { return parseInt(this._get('ex_hi') || '0'); },
gm() { return parseInt(this._get('ex_gm') || '0'); },
li() { return parseInt(this._get('ex_li') || '0'); },
lastSc() { return parseInt(this._get('ex_last') || '0'); },
bestCombo() { return parseInt(this._get('ex_bc') || '0'); },
totalTspins() { return parseInt(this._get('ex_ts') || '0'); },
totalTetris() { return parseInt(this._get('ex_tt') || '0'); },
save(sc, li, combo, tspins, tetrisCount) {
if (sc > this.hi()) this._set('ex_hi', sc);
if (combo > this.bestCombo()) this._set('ex_bc', combo);
this._set('ex_last', sc);
this._set('ex_gm', this.gm() + 1);
this._set('ex_li', this.li() + li);
this._set('ex_ts', this.totalTspins() + tspins);
this._set('ex_tt', this.totalTetris() + tetrisCount);
}
};
(function() {
const T = [[1,1,1],[0,1,0],[0,1,0]];
const cols = Object.values(PC);
const g = document.getElementById('lgrid');
if (!g) return;
T.forEach((row, r) => row.forEach((v, c) => {
const el = document.createElement('div');
el.className = 'lc';
el.style.background = v ? cols[(r * 3 + c) % cols.length] : 'transparent';
g.appendChild(el);
}));
})();
const rainCvs = document.getElementById('rain');
const rainX = rainCvs ? rainCvs.getContext('2d') : null;
let rainOn = true;
function resizeRain() { if (!rainCvs) return; rainCvs.width = window.innerWidth; rainCvs.height = window.innerHeight; }
resizeRain();
window.addEventListener('resize', resizeRain);
const DROPS = (() => {
const ps = Object.values(SHP), cs = Object.values(PC);
return Array.from({ length: 12 }, () => ({
p: ps[0 | Math.random() * ps.length],
x: Math.random() * window.innerWidth,
y: Math.random() * window.innerHeight - window.innerHeight,
spd: .22 + Math.random() * .48,
rot: Math.random() * 360,
col: cs[0 | Math.random() * cs.length],
sz: 9 + Math.random() * 5
}));
})();
(function rl() {
if (rainOn && rainX) {
rainX.clearRect(0, 0, rainCvs.width, rainCvs.height);
DROPS.forEach(d => {
d.y += d.spd;
d.rot += .22;
if (d.y > rainCvs.height + 60) { d.y = -70; d.x = Math.random() * rainCvs.width; }
rainX.save();
rainX.translate(d.x, d.y);
rainX.rotate(d.rot * Math.PI / 180);
rainX.globalAlpha = .1;
d.p.s.forEach((row, ry) => row.forEach((v, cx) => {
if (!v) return;
rainX.fillStyle = d.col;
rainX.fillRect(cx * d.sz - d.p.s[0].length * d.sz * .5, ry * d.sz - d.p.s.length * d.sz * .5, d.sz - 1, d.sz - 1);
}));
rainX.restore();
});
}
requestAnimationFrame(rl);
})();
let CUR = 's1';
function go(id) {
const prev = document.getElementById(CUR);
const next = document.getElementById(id);
if (prev) prev.classList.remove('on');
if (next) next.classList.add('on');
CUR = id;
const sw = next ? next.querySelector('.sw') : null;
if (sw) sw.scrollTop = 0;
}
function refreshLanding() {
const h = DB.hi(), g = DB.gm(), l = DB.li();
const hi = document.getElementById('l-hi');
const gm = document.getElementById('l-gm');
const li = document.getElementById('l-li');
if (hi) hi.textContent = h > 0 ? h.toLocaleString() : '‚Äî';
if (gm) gm.textContent = g > 0 ? g.toLocaleString() : '‚Äî';
if (li) li.textContent = l > 0 ? l.toLocaleString() : '‚Äî';
const rank = getRank(l);
const rb = document.getElementById('l-rank');
if (l > 0 && rb) {
rb.style.display = 'inline-flex';
document.getElementById('l-rank-t').textContent = rank.name;
rb.querySelector('.rank-ico').textContent = rank.ico;
}
const sk = document.getElementById('l-streak');
if (SESSION_STREAK > 1 && sk) { sk.style.display = 'block'; sk.textContent = 'üî• Racha: ' + SESSION_STREAK + ' partidas esta sesi√≥n'; }
else if (sk) sk.style.display = 'none';
const ch = document.getElementById('l-challenge');
if (ch) {
if (g === 0) ch.textContent = 'Tu historia empieza aqu√≠.';
else if (h > 0) ch.textContent = '¬øPuedes superar los ' + h.toLocaleString() + ' puntos?';
else ch.textContent = 'Cada partida es una oportunidad.';
}
}
refreshLanding();
let MODE = 'marathon';
const UI = {
mode(el, m) {
document.querySelectorAll('.mc').forEach(c => {
c.classList.remove('on');
c.setAttribute('aria-checked', 'false');
});
el.classList.add('on');
el.setAttribute('aria-checked', 'true');
MODE = m;
},
play() {
rainOn = false;
go('s3');
requestWakeLock();
setTimeout(() => { resizeBoard(); G.startWithCountdown(); }, 60);
},
openManual() { go('s2'); },
closeManual() { go('s1'); },
playFromManual() {
rainOn = false;
go('s3');
requestWakeLock();
setTimeout(() => { resizeBoard(); G.startWithCountdown(); }, 60);
},
retry() {
go('s3');
requestWakeLock();
setTimeout(() => { resizeBoard(); G.startWithCountdown(); }, 60);
},
quitFarewell() {
if (G) { G.running = false; if (G.raf) cancelAnimationFrame(G.raf); }
releaseWakeLock();
this._fw();
},
farewell() { releaseWakeLock(); this._fw(); },
_fw() {
const fw = FW_B[0 | Math.random() * FW_B.length];
const fwE = document.getElementById('fw-e');
const fwQ = document.getElementById('fw-q');
const fwH = document.getElementById('fw-hi');
if (fwE) fwE.textContent = fw.e;
if (fwQ) fwQ.textContent = fw.q;
const h = DB.hi();
if (fwH) fwH.textContent = h > 0 ? h.toLocaleString() : '‚Äî';
go('s6');
},
toLanding() { rainOn = true; refreshLanding(); go('s1'); }
};
let wakeLock = null;
async function requestWakeLock() {
try {
if ('wakeLock' in navigator) {
wakeLock = await navigator.wakeLock.request('screen');
wakeLock.addEventListener('release', () => { wakeLock = null; });
}
} catch(e) {}
}
function releaseWakeLock() {
try { if (wakeLock) { wakeLock.release(); wakeLock = null; } }
catch(e) {}
}
const gCvs = document.getElementById('gcvs');
const gCtx = gCvs ? gCvs.getContext('2d') : null;
const hCvs = document.getElementById('cv-h');
const hCtx = hCvs ? hCvs.getContext('2d') : null;
const nCvs = document.getElementById('cv-n');
const nCtx = nCvs ? nCvs.getContext('2d') : null;
let CELL = 28;
function resizeBoard() {
if (!gCvs || !gCtx) return;
const hudEl = document.getElementById('hud');
const ctrlEl = document.getElementById('gctrl');
const sideEl = document.querySelector('.gside');
if (!hudEl) return;
const hud = hudEl.getBoundingClientRect();
const ctrlH = ctrlEl && ctrlEl.offsetParent !== null ? ctrlEl.getBoundingClientRect().height : 0;
const sideW = sideEl ? sideEl.getBoundingClientRect().width : 50;
const deskStats = document.getElementById('desk-stats');
const deskW = deskStats && deskStats.offsetParent !== null ? deskStats.getBoundingClientRect().width + 12 : 0;
const W = window.innerWidth, H = window.innerHeight;
const availH = H - hud.height - ctrlH - 14;
const availW = W - (sideW + 5) * 2 - 18 - deskW;
const cH = Math.floor(availH / ROWS), cW = Math.floor(availW / COLS);
CELL = Math.max(12, Math.min(cH, cW));
gCvs.width = CELL * COLS;
gCvs.height = CELL * ROWS;
const b = document.getElementById('board');
if (b) {
b.style.width = gCvs.width + 'px';
b.style.height = gCvs.height + 'px';
}
if (nCvs) nCvs.height = Math.min(CELL * 13 + 20, 220);
if (G && G.piece) { G.draw(); G.sides(); }
}
window.addEventListener('resize', () => {
if (CUR === 's3') resizeBoard();
});
function adj(hex, a) {
const n = parseInt(hex.slice(1), 16);
const r = Math.min(255, Math.max(0, ((n >> 16) & 255) + Math.round(a * 255)));
const g = Math.min(255, Math.max(0, ((n >> 8) & 255) + Math.round(a * 255)));
const b = Math.min(255, Math.max(0, (n & 255) + Math.round(a * 255)));
return 'rgb(' + r + ',' + g + ',' + b + ')';
}
class SFX {
constructor() { this.a = null; }
init() {
if (this.a) return;
try { this.a = new (window.AudioContext || window.webkitAudioContext)(); }
catch(e) {}
}
_t(f, t, d, v) {
if (v === undefined) v = .07;
if (!this.a) return;
try {
if (this.a.state === 'suspended') this.a.resume();
const o = this.a.createOscillator(), g = this.a.createGain();
o.type = t; o.frequency.value = f;
g.gain.setValueAtTime(v, this.a.currentTime);
g.gain.exponentialRampToValueAtTime(.001, this.a.currentTime + d);
o.connect(g); g.connect(this.a.destination);
o.start(); o.stop(this.a.currentTime + d);
} catch(e) {}
}
move() { this._t(260, 'sine', .04, .05); }
rotate() { this._t(480, 'triangle', .06, .07); }
lock() { this._t(180, 'sine', .06, .09); }
hold() { this._t(360, 'sine', .09, .09); }
clear(n) { [523,659,784,1047].slice(0, n).forEach((f, i) => setTimeout(() => this._t(f, 'sine', .2, .13), i * 55)); }
tspin() { [659,880,1047].forEach((f, i) => setTimeout(() => this._t(f, 'square', .12, .1), i * 45)); }
allcl() { [523,659,784,1047,1319].forEach((f, i) => setTimeout(() => this._t(f, 'sine', .25, .15), i * 70)); }
over() { [400,350,300,250,200].forEach((f, i) => setTimeout(() => this._t(f, 'sawtooth', .35, .12), i * 110)); }
lvlup() { [784,880,1047].forEach((f, i) => setTimeout(() => this._t(f, 'sine', .18, .18), i * 90)); }
combo(n) { this._t(200 + n * 50, 'triangle', .09, .11); }
countdown() { this._t(440, 'sine', .12, .12); }
countdownGo() { [523,659,784].forEach((f, i) => setTimeout(() => this._t(f, 'sine', .14, .16), i * 40)); }
newRecord() { [784,988,1175,1319].forEach((f, i) => setTimeout(() => this._t(f, 'sine', .2, .18), i * 80)); }
}
function hap(d) {
if (d === undefined) d = 7;
try { if (navigator.vibrate) navigator.vibrate(d); } catch(e) {}
}
const rot90 = m => m[0].map((_, i) => m.map(r => r[i]).reverse());
const dc = m => JSON.parse(JSON.stringify(m));
function makeBag() {
const k = [...Object.keys(SHP)];
for (let i = k.length - 1; i > 0; i--) {
const j = 0 | Math.random() * (i + 1);
[k[i], k[j]] = [k[j], k[i]];
}
return k;
}
function animateScore(el) {
if (!el) return;
el.classList.remove('score-pop');
void el.offsetWidth;
el.classList.add('score-pop');
}
class Engine {
constructor() {
this.sfx = new SFX();
this.hi = DB.hi();
this.running = false;
this.raf = null;
this._input();
document.addEventListener('visibilitychange', () => {
if (document.hidden && this.running && !this.paused_ && !this.over_) this.pause();
});
}
startWithCountdown() {
this.sfx.init();
const cd = document.getElementById('countdown'), num = document.getElementById('cd-num'), lbl = document.getElementById('cd-label');
if (!cd || !num) return this.start();
cd.classList.add('on');
const steps = ['3', '2', '1', 'GO'];
let i = 0;
const tick = () => {
if (i < steps.length) {
num.textContent = steps[i];
num.style.color = i < 3 ? 'var(--cyan)' : 'var(--green)';
lbl.textContent = i < 3 ? 'Prep√°rate' : '';
num.style.animation = 'none'; void num.offsetWidth; num.style.animation = 'cdPop .35s var(--spring)';
if (i < 3) this.sfx.countdown(); else this.sfx.countdownGo();
hap(i < 3 ? 5 : 15);
i++; setTimeout(tick, i <= 3 ? 700 : 400);
} else { cd.classList.remove('on'); this.start(); }
};
tick();
}
start() {
this.sfx.init();
this.running = true;
this.over_ = false;
this.paused_ = false;
this.board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
this.sc = 0; this.li = 0; this.lv = 1;
this.combo = -1; this.btb = false;
this.bag = []; this.q = [];
this.hold_ = null; this.canHold = true;
this.ts = 0; this.dropA = 0;
this.lockA = 0; this.lockM = 0; this.lockOn = false;
this.tspin_ = null;
this.mode_ = MODE;
this.modeT = 0;
this.blitzLv = 1;
this.maxCombo = 0; this.tspinCount = 0; this.tetrisCount = 0;
this.nearRecShown = false; this._recordBeaten = false; this.lastMilestone = 0;
this.holdCount_ = 0;
const nr = document.getElementById('near-rec'), bd = document.getElementById('board'), hsc = document.getElementById('hsc');
if (nr) nr.classList.remove('on'); if (bd) bd.classList.remove('near-glow'); if (hsc) hsc.classList.remove('glow-rec');
this._fillQ(); this._spawn(); this._ui(); this._modeLbl();
go('s3'); CUR = 's3';
if (this.raf) cancelAnimationFrame(this.raf);
this.raf = requestAnimationFrame(this._loop.bind(this));
}
_modeLbl() {
const lbl = document.getElementById('hv-lbl');
if (lbl) lbl.textContent = (this.mode_ === 'ultra' || this.mode_ === 'blitz') ? 'Tiempo' : 'Nivel';
}
_fillQ() {
while (this.q.length < 5) {
if (!this.bag.length) this.bag = makeBag();
const k = this.bag.pop();
this.q.push({ t: k, s: dc(SHP[k].s) });
}
this._dNext();
}
_spawn() {
const n = this.q.shift();
this._fillQ();
const s = dc(SHP[n.t].s);
this.piece = { t: n.t, s, r: 0, x: n.t === 'O' ? 4 : 3, y: n.t === 'I' ? -1 : 0 };
this.tspin_ = null;
this.lockOn = false;
this.lockA = 0;
this.lockM = 0;
if (this._col(this.board, this.piece)) { this._end(); return; }
this.canHold = true;
this.draw();
this.sides();
}
_col(b, p) {
for (let r = 0; r < p.s.length; r++) {
for (let c = 0; c < p.s[r].length; c++) {
if (!p.s[r][c]) continue;
const nr = r + p.y, nc = c + p.x;
if (nc < 0 || nc >= COLS || nr >= ROWS) return true;
if (nr >= 0 && b[nr][nc]) return true;
}
}
return false;
}
_merge() {
this.piece.s.forEach((row, r) => row.forEach((v, c) => {
if (v) {
const pr = r + this.piece.y, pc = c + this.piece.x;
if (pr >= 0 && pr < ROWS && pc >= 0 && pc < COLS) {
this.board[pr][pc] = this.piece.t;
}
}
}));
}
tryRot(dir) {
const nr = ((this.piece.r + dir + 4) % 4);
const ns = dir > 0 ? rot90(this.piece.s) : rot90(rot90(rot90(this.piece.s)));
const kicks = this.piece.t === 'I' ? KI : KN;
for (const [kx, ky] of kicks[this.piece.r]) {
const t = { ...this.piece, s: ns, r: nr, x: this.piece.x + kx, y: this.piece.y - ky };
if (!this._col(this.board, t)) {
this.piece = { ...t };
if (this.piece.t === 'T') this._cts();
this.sfx.rotate(); hap(4);
if (this.lockOn) this._rlock();
this.draw();
return true;
}
}
return false;
}
_cts() {
const co = [[0,0],[0,2],[2,0],[2,2]];
let fl = 0;
co.forEach(([r, c]) => {
const br = this.piece.y + r, bc = this.piece.x + c;
if (br < 0 || br >= ROWS || bc < 0 || bc >= COLS || (this.board[br] && this.board[br][bc])) fl++;
});
if (fl < 3) { this.tspin_ = null; return; }
const fi = this.piece.r === 0 ? [0,1] : this.piece.r === 1 ? [1,3] : this.piece.r === 2 ? [2,3] : [0,2];
let ff = 0;
fi.forEach(i => {
const [r, c] = co[i];
const br = this.piece.y + r, bc = this.piece.x + c;
if (br < 0 || br >= ROWS || bc < 0 || bc >= COLS || (this.board[br] && this.board[br][bc])) ff++;
});
this.tspin_ = ff === 2 ? 'n' : 'm';
}
move(dx) {
this.piece.x += dx;
if (this._col(this.board, this.piece)) { this.piece.x -= dx; return false; }
this.sfx.move(); hap(3); this.tspin_ = null;
if (this.lockOn) this._rlock();
this.draw();
return true;
}
softDrop() {
this.piece.y++;
if (this._col(this.board, this.piece)) { this.piece.y--; this._lock(); return; }
this.sc += 1; this.dropA = 0; this.draw();
}
hardDrop() {
let d = 0;
while (!this._col(this.board, { ...this.piece, y: this.piece.y + 1 })) { this.piece.y++; d++; }
this.sc += d * 2; hap(14); this._lock();
}
_lock() {
if (this.over_) return;
this._merge(); this.sfx.lock(); hap(7);
this.lockOn = false; this._sweep();
}
_rlock() {
if (this.lockM < 15) { this.lockA = 0; this.lockM++; }
}
_sweep() {
const rows = [];
for (let r = ROWS - 1; r >= 0; r--) {
if (this.board[r].every(v => v)) rows.push(r);
}
const n = rows.length;
if (n > 0) {
this._flash(rows, () => {
rows.forEach(r => {
this.board.splice(r, 1);
this.board.unshift(Array(COLS).fill(0));
});
this.draw();
});
const ts = this.tspin_;
const PL = [0, 100, 300, 500, 800];
const PT = [400, 800, 1200, 1600];
const PM = [100, 200, 400];
const effectiveLv = this.mode_ === 'blitz' ? this.blitzLv : this.lv;
let pts = ts === 'n' ? (PT[n] || 0) * effectiveLv : ts === 'm' ? (PM[n] || 0) * effectiveLv : (PL[n] || 0) * effectiveLv;
const btb = (n === 4) || (ts === 'n' && n > 0);
if (btb && this.btb) pts = Math.floor(pts * 1.5);
this.btb = btb;
this.combo++;
if (this.combo > 0) { pts += 50 * this.combo * effectiveLv; this.sfx.combo(this.combo); }
if (this.combo > this.maxCombo) this.maxCombo = this.combo;
if (n === 4) this.tetrisCount++;
if (ts === 'n') this.tspinCount++;
const ac = this.board.every(r => r.every(v => !v));
if (ac) { pts += 3500 * effectiveLv; this.sfx.allcl(); }
this.sc += pts;
this.li += n;
if (ts === 'n') this.sfx.tspin(); else this.sfx.clear(n);
hap(n === 4 ? 28 : 12);
this._fbPts(pts, rows[rows.length - 1]);
if (this.combo > 1) this._fbEl('fb-combo', this.combo + '√ó COMBO!', '25%');
if (ts) this._fbEl('fb-tspin', ts === 'n' ? 'T-SPIN ' + ['','SINGLE','DOUBLE','TRIPLE'][n] || '' : 'T-SPIN MINI', '40%');
if (ac) this._fbEl('fb-ac', '‚ú¶ ALL CLEAR ‚ú¶', '18%');
this._shake(); this._ptcs();
for (const ms of MILESTONES) {
if (this.li >= ms.at && this.lastMilestone < ms.at) {
this.lastMilestone = ms.at; this._fbEl('fb-msg', ms.msg, '50%'); break;
}
}
const nl = Math.floor(this.li / 10) + 1;
if (nl > this.lv && this.mode_ !== 'blitz') {
this.lv = nl; this.sfx.lvlup(); hap(20);
const lf = document.getElementById('lf');
if (lf) { lf.classList.add('on'); setTimeout(() => lf.classList.remove('on'), 180); }
this._fbEl('fb-lv', 'NIVEL ' + this.lv, '30%');
}
if (this.mode_ === 'blitz') {
const newBlitzLv = Math.min(15, Math.floor(this.modeT / 30000) + 1);
if (newBlitzLv > this.blitzLv) {
this.blitzLv = newBlitzLv;
this.sfx.lvlup(); hap(20);
this._fbEl('fb-lv', 'VELOCIDAD ' + this.blitzLv, '30%');
}
}
if (this.mode_ === 'sprint' && this.li >= 40) this._end();
if (this.hi > 0 && this.sc >= this.hi * .8 && !this.nearRecShown) {
this.nearRecShown = true;
const nrEl = document.getElementById('near-rec'), bdEl = document.getElementById('board'), hscEl = document.getElementById('hsc');
if (nrEl) nrEl.classList.add('on'); if (bdEl) bdEl.classList.add('near-glow'); if (hscEl) hscEl.classList.add('glow-rec');
}
if (this.sc > this.hi && this.hi > 0 && !this._recordBeaten) {
this._recordBeaten = true; this.sfx.newRecord(); hap(30);
this._fbEl('fb-ac', '‚òÖ NUEVO R√âCORD ‚òÖ', '15%');
}
this._deskStats();
animateScore(document.getElementById('hv-sc'));
this._ui();
} else {
this.combo = -1;
this.tspin_ = null;
}
this._spawn();
}
_flash(rows, cb) {
let i = 0;
const snap = dc(this.board);
const fl = () => {
if (i < 6) {
rows.forEach(r => {
for (let c = 0; c < COLS; c++) snap[r][c] = i % 2 === 0 ? 'X' : 0;
});
this._brd(snap); i++;
setTimeout(fl, 36);
} else { cb(); }
};
fl();
}
_fbPts(pts, row) {
const w = document.getElementById('bwrap');
if (!w) return;
const el = document.createElement('div');
el.className = 'fb fb-pts';
el.style.cssText = 'color:' + (pts > 800 ? '#ffd000' : '#fff') + ';top:' + Math.max(5, row / ROWS * 85) + '%;left:50%;transform:translateX(-50%);';
el.textContent = '+' + pts.toLocaleString();
w.appendChild(el);
setTimeout(() => el.remove(), 860);
}
_fbEl(cls, text, top) {
const w = document.getElementById('bwrap');
if (!w) return;
const el = document.createElement('div');
el.className = 'fb ' + cls;
el.style.top = top;
el.textContent = text;
w.appendChild(el);
setTimeout(() => el.remove(), 1200);
}
_shake() {
const b = document.getElementById('board');
if (!b) return;
b.classList.remove('shk');
void b.offsetWidth;
b.classList.add('shk');
setTimeout(() => b.classList.remove('shk'), 300);
}
_ptcs() {
if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
const r = document.getElementById('board');
if (!r) return;
const rect = r.getBoundingClientRect();
const cx = rect.left + rect.width / 2, cy = rect.top + rect.height / 2;
const cs = Object.values(PC);
for (let i = 0; i < 18; i++) {
const p = document.createElement('div');
const px = (Math.random() - .5) * 200, py = (Math.random() - .5) * 200;
p.className = 'ptc';
p.style.cssText = 'width:5px;height:5px;background:' + cs[0 | Math.random() * cs.length] + ';left:' + cx + 'px;top:' + cy + 'px;--px:' + px + 'px;--py:' + py + 'px;';
document.body.appendChild(p);
setTimeout(() => p.remove(), 720);
}
}
_deskStats() {
const $ = id => document.getElementById(id);
if ($('ds-combo')) $('ds-combo').textContent = this.maxCombo;
if ($('ds-tspin')) $('ds-tspin').textContent = this.tspinCount;
if ($('ds-tetris')) $('ds-tetris').textContent = this.tetrisCount;
if ($('ds-streak')) $('ds-streak').textContent = SESSION_STREAK;
}
hold() {
if (!this.canHold) return;
const cur = this.piece.t;
if (this.hold_) {
const old = this.hold_;
this.hold_ = cur;
this.piece = { t: old, s: dc(SHP[old].s), r: 0, x: old === 'O' ? 4 : 3, y: old === 'I' ? -1 : 0 };
} else {
this.hold_ = cur;
this._spawn();
}
this.canHold = false;
this.holdCount_ = (this.holdCount_ || 0) + 1;
this.sfx.hold(); hap(10);
this.sides(); this.draw();
}
pause() {
if (this.over_) return;
this.paused_ = true;
if (this.raf) cancelAnimationFrame(this.raf);
const psv = document.getElementById('ps-v');
if (psv) psv.textContent = this.sc.toLocaleString();
go('s4');
}
resume() {
this.paused_ = false;
this.ts = performance.now();
go('s3'); CUR = 's3';
this.raf = requestAnimationFrame(this._loop.bind(this));
}
_end() {
this.over_ = true;
this.running = false;
if (this.raf) cancelAnimationFrame(this.raf);
this.sfx.over(); hap(45);
releaseWakeLock();
SESSION_STREAK++;
const prevSc = DB.lastSc();
const newHi = this.sc > this.hi;
if (newHi) this.hi = this.sc;
DB.save(this.sc, this.li, this.maxCombo, this.tspinCount, this.tetrisCount);
this.hi = DB.hi();
const nrEl = document.getElementById('near-rec'), bdEl = document.getElementById('board'), hscEl = document.getElementById('hsc');
if (nrEl) nrEl.classList.remove('on'); if (bdEl) bdEl.classList.remove('near-glow'); if (hscEl) hscEl.classList.remove('glow-rec');
const $ = id => document.getElementById(id);
const q = GO_B[0 | Math.random() * GO_B.length];
if ($('go-e')) $('go-e').textContent = q.e;
if ($('go-q')) $('go-q').textContent = q.q;
if ($('go-sc')) $('go-sc').textContent = this.sc.toLocaleString();
if ($('go-li')) $('go-li').textContent = this.li;
if ($('go-lv')) $('go-lv').textContent = this.lv;
if ($('go-hi')) $('go-hi').textContent = this.hi.toLocaleString();
if ($('nrec')) $('nrec').style.display = newHi ? 'block' : 'none';
const delta = $('go-delta');
if (delta && prevSc > 0) {
const diff = this.sc - prevSc;
if (diff > 0) { delta.style.color = 'var(--green)'; delta.textContent = '‚ñ≤ +' + diff.toLocaleString() + ' pts vs tu anterior'; }
else if (diff < 0) { delta.style.color = 'var(--red)'; delta.textContent = '‚ñº ' + diff.toLocaleString() + ' pts vs tu anterior'; }
else { delta.style.color = 'rgba(255,255,255,.3)'; delta.textContent = 'Misma puntuaci√≥n que la anterior'; }
} else if (delta) { delta.textContent = ''; }
const hook = $('go-hook');
if (hook) {
let h = '';
if (!newHi && this.hi > 0) { const diff = this.hi - this.sc; if (diff < this.hi * .3) h = 'Solo te faltaron ' + diff.toLocaleString() + ' puntos para tu r√©cord.'; }
if (!h && this.maxCombo > 1) h = 'Tu mejor combo fue ' + this.maxCombo + '√ó. ¬øPuedes superarlo?';
if (!h && SESSION_STREAK > 1) h = 'Llevas ' + SESSION_STREAK + ' partidas. ¬°No pares!';
if (!h) h = 'El 80% de jugadores mejoran en la siguiente partida.';
hook.textContent = h;
}
refreshLanding();
setTimeout(() => go('s5'), 650);
}
_loop(ts) {
if (!this.running || this.paused_ || this.over_) return;
const dt = Math.min(ts - (this.ts || ts), 50);
this.ts = ts;
if (this.mode_ === 'ultra' || this.mode_ === 'blitz') {
this.modeT += dt;
const max = this.mode_ === 'ultra' ? 120000 : 180000;
const rem = Math.max(0, max - this.modeT);
const s = Math.ceil(rem / 1000);
const lvEl = document.getElementById('hv-lv');
if (lvEl) lvEl.textContent = Math.floor(s / 60) + ':' + String(s % 60).padStart(2, '0');
if (rem <= 0) { this._end(); return; }
}
const gravLevel = this.mode_ === 'blitz' ? this.blitzLv : this.lv;
const grav = GV[Math.min(gravLevel - 1, GV.length - 1)];
this.dropA += dt;
if (this.dropA > grav) {
this.dropA -= grav;
this.piece.y++;
if (this._col(this.board, this.piece)) {
this.piece.y--;
if (!this.lockOn) { this.lockOn = true; this.lockA = 0; }
}
}
if (this.lockOn) {
this.lockA += dt;
if (this.lockA > 500) this._lock();
}
this.draw();
this.raf = requestAnimationFrame(this._loop.bind(this));
}
_gy() {
let y = this.piece.y;
while (!this._col(this.board, { ...this.piece, y: y + 1 })) y++;
return y;
}
_dc(ctx, px, py, type) {
const s = CELL - 1;
if (type === 'X') {
ctx.fillStyle = 'rgba(255,255,255,0.88)';
ctx.fillRect(px, py, s, s);
return;
}
const col = PC[type] || '#888';
const gl = PG[type] || 'rgba(255,255,255,0.5)';
ctx.shadowColor = gl;
ctx.shadowBlur = CELL * 0.8;
const g = ctx.createLinearGradient(px, py, px, py + s);
g.addColorStop(0, adj(col, .35));
g.addColorStop(.5, col);
g.addColorStop(1, adj(col, -.25));
ctx.fillStyle = g;
const rad = Math.max(2, CELL * .12);
ctx.beginPath(); ctx.roundRect(px + .5, py + .5, s - 1, s - 1, rad); ctx.fill();
ctx.shadowBlur = 0;
ctx.fillStyle = 'rgba(255,255,255,0.25)';
ctx.fillRect(px + 2, py + 2, s - 4, Math.max(3, s * .3));
ctx.strokeStyle = 'rgba(255,255,255,0.08)';
ctx.lineWidth = .5;
ctx.beginPath(); ctx.roundRect(px + .5, py + .5, s - 1, s - 1, rad); ctx.stroke();
}
_brd(board) {
if (!gCtx || !gCvs) return;
const w = gCvs.width, h = gCvs.height;
gCtx.fillStyle = 'rgba(0,0,0,0.65)';
gCtx.fillRect(0, 0, w, h);
gCtx.strokeStyle = 'rgba(255,255,255,0.02)';
gCtx.lineWidth = .5;
for (let r = 0; r <= ROWS; r++) { gCtx.beginPath(); gCtx.moveTo(0, r * CELL); gCtx.lineTo(w, r * CELL); gCtx.stroke(); }
for (let c = 0; c <= COLS; c++) { gCtx.beginPath(); gCtx.moveTo(c * CELL, 0); gCtx.lineTo(c * CELL, h); gCtx.stroke(); }
board.forEach((row, r) => row.forEach((v, c) => {
if (v) this._dc(gCtx, c * CELL, r * CELL, v);
}));
}
draw() {
if (!this.piece || !gCtx) return;
this._brd(this.board);
const gy = this._gy();
this.piece.s.forEach((row, r) => row.forEach((v, c) => {
if (!v) return;
const gr = r + gy, gc = c + this.piece.x;
if (gr >= 0 && gr < ROWS && gc >= 0 && gc < COLS && gr !== (r + this.piece.y)) {
const s = CELL - 1;
const rad = Math.max(2, CELL * .1);
gCtx.strokeStyle = 'rgba(255,255,255,0.22)';
gCtx.lineWidth = 1.2;
gCtx.fillStyle = 'rgba(255,255,255,0.06)';
gCtx.beginPath(); gCtx.roundRect(gc * CELL + .5, gr * CELL + .5, s - 1, s - 1, rad);
gCtx.fill(); gCtx.stroke();
}
}));
const lp = this.lockOn ? (Math.sin(Date.now() / 75) * .18 + .82) : 1;
gCtx.globalAlpha = lp;
this.piece.s.forEach((row, r) => row.forEach((v, c) => {
if (!v) return;
const py = r + this.piece.y, px = c + this.piece.x;
if (py >= 0 && py < ROWS && px >= 0 && px < COLS) {
this._dc(gCtx, px * CELL, py * CELL, this.piece.t);
}
}));
gCtx.globalAlpha = 1;
}
_dMini(ctx, cvs, type) {
if (!ctx || !cvs) return;
ctx.clearRect(0, 0, cvs.width, cvs.height);
if (!type) return;
const sh = SHP[type].s;
const cell = Math.floor(Math.min(cvs.width / (sh[0].length + .6), cvs.height / (sh.length + .6)));
const ox = Math.floor((cvs.width - sh[0].length * cell) / 2);
const oy = Math.floor((cvs.height - sh.length * cell) / 2);
sh.forEach((row, r) => row.forEach((v, c) => {
if (!v) return;
const px = ox + c * cell, py = oy + r * cell, s = cell - 1;
const col = PC[type], gl = PG[type];
ctx.shadowColor = gl; ctx.shadowBlur = 5;
const g = ctx.createLinearGradient(px, py, px, py + s);
g.addColorStop(0, adj(col, .3)); g.addColorStop(1, adj(col, -.25));
ctx.fillStyle = g; ctx.beginPath(); ctx.roundRect(px, py, s, s, 2); ctx.fill();
ctx.shadowBlur = 0;
}));
}
_dNext() {
if (!nCtx || !nCvs) return;
nCtx.clearRect(0, 0, nCvs.width, nCvs.height);
let oy = 2;
this.q.slice(0, 4).forEach((item, idx) => {
const sh = item.s;
const cell = idx === 0 ? Math.min(Math.floor(nCvs.width / (sh[0].length + .6)), 13) : 9;
const ox = Math.floor((nCvs.width - sh[0].length * cell) / 2);
nCtx.globalAlpha = idx === 0 ? 1 : idx === 1 ? .62 : idx === 2 ? .4 : .24;
sh.forEach((row, r) => row.forEach((v, c) => {
if (!v) return;
const px = ox + c * cell, py = oy + r * cell, s = cell - 1;
const col = PC[item.t], gl = PG[item.t];
if (idx === 0) { nCtx.shadowColor = gl; nCtx.shadowBlur = 5; }
const g = nCtx.createLinearGradient(px, py, px, py + s);
g.addColorStop(0, adj(col, .3)); g.addColorStop(1, adj(col, -.25));
nCtx.fillStyle = g; nCtx.beginPath(); nCtx.roundRect(px, py, s, s, 2); nCtx.fill();
nCtx.shadowBlur = 0;
}));
nCtx.globalAlpha = 1;
oy += sh.length * cell + 5;
});
}
sides() { this._dMini(hCtx, hCvs, this.hold_); this._dNext(); }
_ui() {
const sc = document.getElementById('hv-sc');
const li = document.getElementById('hv-li');
const lv = document.getElementById('hv-lv');
const hi = document.getElementById('hv-hi');
if (sc) sc.textContent = this.sc.toLocaleString();
if (li) li.textContent = this.li;
if (this.mode_ !== 'ultra' && this.mode_ !== 'blitz' && lv) lv.textContent = this.lv;
if (hi) hi.textContent = this.hi.toLocaleString();
}
_input() {
const bw = document.getElementById('bwrap');
if (!bw) return;
let sx, sy, st, drag = false, dDir = null, lastTap = 0, tapTimer = null;
bw.addEventListener('touchstart', e => {
e.preventDefault();
const t = e.touches[0];
sx = t.clientX; sy = t.clientY; st = Date.now();
drag = false; dDir = null;
}, { passive: false });
bw.addEventListener('touchmove', e => {
e.preventDefault();
if (!this.running || this.paused_ || this.over_) return;
const t = e.touches[0], dx = t.clientX - sx, dy = t.clientY - sy;
const adx = Math.abs(dx), ady = Math.abs(dy);
if (!drag && (adx > 10 || ady > 10)) {
drag = true;
dDir = adx > ady ? 'h' : 'v';
}
if (drag && dDir === 'h') {
const mv = Math.round(dx / CELL);
if (mv) { this.move(Math.sign(mv)); sx += Math.sign(mv) * CELL; }
}
if (drag && dDir === 'v' && dy > CELL * .6) { this.softDrop(); sy += CELL * .6; }
}, { passive: false });
bw.addEventListener('touchend', e => {
e.preventDefault();
const now = Date.now();
const ex = e.changedTouches[0].clientX;
const ey = e.changedTouches[0].clientY;
const totalDy = ey - sy, totalTime = now - st;
if (drag && dDir === 'v' && totalDy > CELL * 2.5 && totalTime < 300) {
if (this.running && !this.paused_) this.hardDrop();
return;
}
if ((sy - ey) > CELL * 1.5 && totalTime < 300) {
if (this.running && !this.paused_) this.hold();
return;
}
if (!drag && totalTime < 220) {
const br = document.getElementById('board');
if (!br) return;
const rect = br.getBoundingClientRect();
const isLeft = ex < rect.left + rect.width / 2;
if (tapTimer) { clearTimeout(tapTimer); tapTimer = null; }
if (now - lastTap < 280 && lastTap > 0) {
if (this.running && !this.paused_) this.hardDrop();
lastTap = 0;
} else {
lastTap = now;
tapTimer = setTimeout(() => {
if (lastTap === now && this.running && !this.paused_) {
this.tryRot(isLeft ? -1 : 1);
}
tapTimer = null;
}, 200);
}
}
}, { passive: false });
const bind = (id, fn, rep) => {
if (rep === undefined) rep = false;
const btn = document.getElementById(id);
if (!btn) return;
let dasTimer, arrTimer, active = false;
const exec = () => {
if (this.running && !this.paused_ && !this.over_) { this.sfx.init(); fn(); }
};
const startRepeat = () => {
dasTimer = setTimeout(() => {
arrTimer = setInterval(exec, 58);
}, 185);
};
btn.addEventListener('pointerdown', e => {
e.preventDefault();
active = true;
exec();
if (rep) startRepeat();
});
const stop = e => {
if (e) e.preventDefault();
active = false;
clearTimeout(dasTimer);
clearInterval(arrTimer);
};
btn.addEventListener('pointerup', stop);
btn.addEventListener('pointerleave', stop);
btn.addEventListener('pointercancel', stop);
};
bind('bt-le', () => this.move(-1), true);
bind('bt-ri', () => this.move(1), true);
bind('bt-dn', () => this.softDrop(), true);
bind('bt-rr', () => this.tryRot(1));
bind('bt-rl', () => this.tryRot(-1));
bind('bt-hd', () => this.hardDrop());
bind('bt-hl', () => this.hold());
const held = {};
let kDas = {}, kArr = {};
document.addEventListener('keydown', e => {
if (held[e.code]) return;
held[e.code] = true;
if (!this.running || this.paused_ || this.over_) {
if ((e.code === 'Escape' || e.code === 'KeyP') && this.paused_) {
this.resume();
}
return;
}
switch (e.code) {
case 'ArrowLeft':
this.move(-1);
kDas['ArrowLeft'] = setTimeout(() => {
kArr['ArrowLeft'] = setInterval(() => this.move(-1), 58);
}, 185);
break;
case 'ArrowRight':
this.move(1);
kDas['ArrowRight'] = setTimeout(() => {
kArr['ArrowRight'] = setInterval(() => this.move(1), 58);
}, 185);
break;
case 'ArrowDown':
this.softDrop();
kDas['ArrowDown'] = setTimeout(() => {
kArr['ArrowDown'] = setInterval(() => this.softDrop(), 58);
}, 185);
break;
case 'ArrowUp': case 'KeyX':
this.tryRot(1); break;
case 'KeyZ': case 'ControlLeft': case 'ControlRight':
this.tryRot(-1); break;
case 'Space':
e.preventDefault(); this.hardDrop(); break;
case 'KeyC': case 'ShiftLeft': case 'ShiftRight':
this.hold(); break;
case 'Escape': case 'KeyP':
this.pause(); break;
}
});
document.addEventListener('keyup', e => {
delete held[e.code];
if (kDas[e.code]) { clearTimeout(kDas[e.code]); delete kDas[e.code]; }
if (kArr[e.code]) { clearInterval(kArr[e.code]); delete kArr[e.code]; }
});
}
}
const G = new Engine();
try {
new MutationObserver(() => {
if (document.getElementById('s3').classList.contains('on')) {
setTimeout(resizeBoard, 80);
}
}).observe(document.getElementById('s3'), { attributes: true, attributeFilter: ['class'] });
} catch(e) {}
try {
if (screen.orientation && screen.orientation.lock) {
screen.orientation.lock('portrait').catch(() => {});
}
} catch(e) {}
</script>
</body>
